# Questionnaire_API

Questionnaire_API - это простой проект REST API, ответ на тестовое задание, а по сути кусочек апи, с двумя ендпоинтами и взаимодействием с базой данных PostgreSQL.

### Задание вкратце:
Реализовать REST апи для опросника, состоящего из анкеты с текстом вопроса и вариантами ответа. 
По нажатию на кнопку "далее", на бекенде сохраняется результат, а в ответ бекенд отдает айди следующего вопроса.

### Условия:
Нужно сделать ASP.NET Core приложение в котором реализовать REST АПИ и написать структуру базы данных, с заранее определенными сущностями, 
все это приложение должно работать в Docker и запускаться через docker-compose файл.

1. Сущности, которые должны присутствовать в базе данных:
   **Survey** - информация об анкете. \
   **Question** - вопрос анкеты. \
   **Answer** - вариант ответа на вопрос анкеты. \
   **Interview** - информация об интервью (отдельной сессии прохождения анкеты конкретным человеком) \
   **Result** - данные ответов людей на вопросы анкеты. <br>

!!! Скрипт создания бд лежит в корне проекта, но можно создать БД и через код, т.е. через переменную среды `ASPNETCORE_CREATE_DB`

2. АПИ должно реализовывать два метода:
  + Получение данных вопроса для отображения на фронте (текста вопроса и вариантов ответа)
  + Сохранение результатов ответа на вопрос по кнопке “Далее”. Принимает выбранные радиобаттоны, возвращает айди следующего вопроса.

#### Немного про структуру кода
Приложение реализовано по трехслойной архитектуре (все слои подключены в program.cs):
 - Presentation layer - Questionnaire_API (контроллер с ендпоинтами)
 - Business layer - уровень бизнес-логики (BusinessLogicLayer) - логика обработки данных
 - Data Access layer - уровень доступа к данным, работа с базой данных.

Для разработки и отладки API подключен Swagger, так же для удобства первого запуска, независимо от операционной системы, отключен https порт 8081 (что бы не нужно было генерировать сертификаты разработчика и прокидывать их в контейнер). \
Все обращения к базе данных асинхронные, и выполняются с помощью Entity Framework Core.

Сборка и использование приложения производиться в разных контейнерах на основе дистрибутива Linux Alpine.


### Как это запустить?
Так как это только кусочек АПИ, для работы вводятся некоторые условности:
  * В бд уже есть анкета с вопросами и ответами к ней.
  * В базу уже добавлена сущность респондента с Guid, временем начала прохождения теста и Ид самого теста.
  * Фронтенд часть знает guid пользователя и айди первого вопроса для отображения у респондента. \

Бекенд автоматически приводит базу данных к этому состоянию, (создает БД) заполняет первый опросник, создает сущность респондента.

Скрипт создания БД лежит в корне проекта с именем: `create db in postgre.sql`.

Приложение может само создать БД и заполнить её данными, но по умолчанию, предполагается что БД уже создана. При первом запуске через docker-compose приложение создаст базу данных и структуру таблиц и заполнит её данными.

Последующий алгоритм работы:
- Фрондент обращается к бекенду по первому методу (получение данных вопроса по айди).
- Респондент отвечает на впрос, нажимает кнопку "Далее", фронтенд обращается по второму методу (отправляя Guid респондента, айди вопроса, айди ответа).
- Бекенд отдает айди следующего вопроса.

### Для запуска приложения в docker-compose, надо выполнить команду:
    docker compose up --build

Для отображения Swagger UI, слеует перейти на следующий адрес [открыть Swagger UI приложения](http://localhost:8080/swagger/index.html "Прямая ссылка на ендпоинты приложения") :

    localhost:8080/swagger/index.html

Остальные настройки и переменные среды описаны в docker-compose файле.\
Внешний порт PostgreSQL: `9435`

<br>
<br>
<br>

----
##### Обратная связь
Если у вас есть замечания по коду, организации проекта, буду очень рад обратной связи, связаться со мной можно по почте или в Telegram: [Артем](https://t.me/usverCdev)
